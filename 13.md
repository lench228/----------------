**  

## 13.1. Назначение и задачи протоколов транспортного уровня. Область применения и сравнение протоколов TCP и UDP. Адресация портов TCP и UDP. Установление TCP- соединения и его завершение. Принципы «трёхстороннего рукопожатия» TCP.
---
Назначение и задачи
---
Протоколы транспортного уровня предназначены для обеспечения непосредственного информационного обмена между двумя пользовательскими процессами (приложениями).
Они также определяют способ передачи сообщений между узлами и могут отвечать за управление требованиями надежности информационного обмена

UDP
---
Протокол UDP относится к транспортным протоколам доставки дейтаграмм  и используется в том случае, если к процессу доставки не предъявляется повышенных требований в части обеспечения  надежности, гарантированности доставки и  управления темпом информационного обмена. Природа UDP как протокола без сохранения состояния также полезна для серверов, отвечающих на небольшие запросы от огромного числа клиентов, например DNS и потоковые мультимедийные приложения вроде IPTV, Voice over IP, протоколы туннелирования IP и многие онлайн-игры

Адресация портов
---
Номера портов используется для того, чтобы идентифицировать транспортные потоки различных приложений данного сетевого узла в процессе его взаимодействия с другими узлами по сети. 

Порты от 0 до 1023 - популярные серверные приложения(ww, smtp, telnet и тд)
От 1024 до 49151 приложения установленные пользователями
От 49152 до 65635 частные(динамические) порты, используются ОС при обращении к приложению

Заголовки сегментов TCP UDP хранят порты назначения и отправителя, и с их помощью их адресуются по сети
TCP
---
Протокол TCP является основным транспортным протоколом сети Internet
	❖Гарантия надежной доставки – TCP обеспечивает гарантированную доставку на узел назначения всех без исключения данных, отправленных источником 
	❖ Обеспечение доставки в нужном порядке - TCP передает данные приложению приемника в том порядке, в котором отправил их отправитель.
	 ❖ Управление темпом передачи данных - TCP передает данные с темпом, который определяет получатель. 
	 ❖ Установление сессии - Перед отправкой данных пользователя TCP согласовывает и настраивает постоянное соединение (или сеанс) между объектами источника и назначения.

Установление TCP соединения
---
Перед отправкой данных TCP согласовывает и настраивает постоянное соединения(сеанс) между устройствами источника и назначения 
	- Инициатор запрашивает сеанс связи, отправляя номер первого передаваемого байта(SYN) на второе удаленное устройство
	-  Второе устройства подтверждает сеанс обмена данными, и запрашивает подтверждение обмена. Отправляет ACK, содержащий номер последнего полученного байта,  подтверждающий получение и SYN 
	- Инициатор подтверждает сеанс, если они синхронизировались, то есть ожидаемый первым устройством номер бита равен тому, что будет отправлен вторым устройством, так и для второго устройства. 

Таким образом происходит "трехстороннее рукопожатие", и устанавливается TCP соединение. 

[![Pasted-image-20240613004952.png](https://i.postimg.cc/G2nfL8DZ/Pasted-image-20240613004952.png)](https://postimg.cc/JyKxKhPq)

Подключение завершается, когда гнезда обмениваются пакетами содержащими флаг FIN.
Флаг отправляется первым устройством, потом второе отвечает ACK, но не получает ответ, и уведомляет первое о том, что соединение прерывается. Затем второе ожидает подтверждения от инициатора и подключение завершается

[![Pasted-image-20240613004959.png](https://i.postimg.cc/Hx0hVY4j/Pasted-image-20240613004959.png)](https://postimg.cc/k64cHdHd)



## 13.2. Использование сеансов TCP для обеспечения гарантированного обмена данными. Роль флагов SYNC и ACK в заголовке сегмента TCP. Управление темпом информационного обмена TCP. Роль поля Window в заголовке сегмента TCP.

Сеанс TCP
---
 TCP гарантирует информационный обмен, те при повреждении пакетов, дублировании их или нарушении порядка, они всё равно будут доставлены корректно, это достигается путем механизма доставки пакетов о котором говорилось ранее. Когда TCP передает данные, запускает таймер, копия данных помещается в очередь повтора передачи и когда система получает флаг подтверждения - ACK, удаляет его из очереди. Если таймер истек - повторяем.
 
ACK
---
Содержит номер последнего принятого байта.

SYN
 ---
Используется при создании соединения, так называемый флаг синхронизации, содержит номер первого отправляемого байта

??%% Проблема с одинаковыми номерами байтов
---
Решается тем, что при установлении  сеанса TCP генерируется 32-битовое число ISN(Initital Sequence Number), которое служит отсчетом нумератора пакета. За счет того, что генератор меняется каждые 4 микросекунды, а время жизни MSL дейтаграммы значительно меньше, проблема решается.

 %% ?? 

Управление темпом информационного обмена
---
Регулирование темпа информационного обмена происходит за счет того, что во время передачи флага ACK, пользователь также передает размер "окна"(Window Size)- это количество байтов, которое может передать отправитель до получения подтверждения об их приеме. 
Размер "окна" задается  количеством байтов, отсчитываемых от номера, заданного в поле Acknowledgment Number последнего полученного сообщения
Нулевой размер окна означает для отправителя команду приостановить передачу до готовности принимать данные получателем

Момент по поводу размера окна, чем оно больше, тем данные будут передаваться быстрее, но при этом стоит помнить о том, что в случае ошибки возрастет объем данных которые потребуется отправить повторно
